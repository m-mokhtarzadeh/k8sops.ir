<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Create Lab from scratch on ubuntu 22.04 - Kubernetes Operations Documents</title><meta name=description content="Kubernetes Operations Fundamentals"><meta name=generator content="Hugo 0.109.0"><link href=https://k8sops.ir//index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://k8sops.ir/session1/scratch_ubuntu/><link rel=stylesheet href=https://k8sops.ir/css/theme.min.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://k8sops.ir/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://k8sops.ir/js/bundle.js></script><style>:root{--custom-font-color:#a9a9b3;--custom-background-color:#292a2d}</style><meta property="og:title" content="Create Lab from scratch on ubuntu 22.04"><meta property="og:description" content="Kubernetes Operations Fundamentals"><meta property="og:type" content="article"><meta property="og:url" content="https://k8sops.ir/session1/scratch_ubuntu/"><meta property="og:image" content="https://k8sops.ir/images/kops.jpg"><meta property="article:section" content="session1"><meta property="article:published_time" content="2022-12-11T15:26:15+00:00"><meta property="article:modified_time" content="2022-12-11T15:26:15+00:00"><meta property="og:site_name" content="Kubernetes Operations"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://k8sops.ir/images/kops.jpg"><meta name=twitter:title content="Create Lab from scratch on ubuntu 22.04"><meta name=twitter:description content="Kubernetes Operations Fundamentals"><meta itemprop=name content="Create Lab from scratch on ubuntu 22.04"><meta itemprop=description content="Kubernetes Operations Fundamentals"><meta itemprop=datePublished content="2022-12-11T15:26:15+00:00"><meta itemprop=dateModified content="2022-12-11T15:26:15+00:00"><meta itemprop=wordCount content="377"><meta itemprop=image content="https://k8sops.ir/images/kops.jpg"><meta itemprop=keywords content></head><body><div class=container><header><h1>Kubernetes Operations Documents</h1><p class=description>This Weblog Just Created For Kubernetes Operations Challenges</p></header><div class=global-menu><nav><ul><li><a href=/>Home</a></li><li><a href=https://m-mokhtarzadeh.ir/>About Me</a></li></ul></nav></div><div class=content-container><main><h1>Create Lab from scratch on ubuntu 22.04</h1><h3 id=step-1-download-ubuntu-linux-2204>Step 1: Download ubuntu linux 22.04</h3><p>Download ubuntu 22.04 from following repository:<br><a href=https://releases.ubuntu.com/22.04/>Ubuntu Linux download repository</a></p><h3 id=step-2-install-dependencies>Step 2: Install dependencies</h3><p>Install following dependencies:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt install
</span></span><span style=display:flex><span>apt install -y vim
</span></span></code></pre></div><h3 id=step-3-disable-firewall>Step 3: Disable firewall</h3><p>Disable firewall:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ufw disable
</span></span></code></pre></div><h3 id=step-4-disable-apparmor>Step 4: Disable apparmor</h3><p>Disable apparmor:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl stop apparmor
</span></span><span style=display:flex><span>systemctl disable apparmor
</span></span><span style=display:flex><span>systemctl mask apparmor
</span></span></code></pre></div><h3 id=step-5-update-system-packages>Step 5: Update system packages</h3><p>Update system packages with following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt update
</span></span><span style=display:flex><span>apt upgrade
</span></span></code></pre></div><p>Install requirements with following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    ca-certificates <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    curl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    gnupg <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    lsb-release
</span></span></code></pre></div><h3 id=step-6-install-latest-version-of-docker>Step 6: Install latest version of docker</h3><p>Add docker repository to server package repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /etc/apt/keyrings
</span></span><span style=display:flex><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#e6db74>&#34;deb [arch=</span><span style=color:#66d9ef>$(</span>dpkg --print-architecture<span style=color:#66d9ef>)</span><span style=color:#e6db74> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#66d9ef>$(</span>lsb_release -cs<span style=color:#66d9ef>)</span><span style=color:#e6db74> stable&#34;</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span></code></pre></div><p>Install docker packages:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin
</span></span></code></pre></div><p>Enable and start docker service with following commands:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl start docker
</span></span><span style=display:flex><span>sudo systemctl enable docker
</span></span><span style=display:flex><span>sudo systemctl status docker
</span></span></code></pre></div><h3 id=step-7-pull-images-for-required-hands-on-lab>Step 7: Pull images for required hands-on lab</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker pull hello-world
</span></span><span style=display:flex><span>docker pull ubuntu
</span></span><span style=display:flex><span>docker pull nginx
</span></span><span style=display:flex><span>docker pull php:7-apache
</span></span></code></pre></div><h3 id=step-8-configuring-docker-for-kubernetes-installation>Step 8: Configuring Docker for kubernetes installation</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | sudo tee /etc/docker/daemon.json
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;log-driver&#34;: &#34;json-file&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;log-opts&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;max-size&#34;: &#34;100m&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;storage-driver&#34;: &#34;overlay2&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;storage-opts&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;overlay2.override_kernel_check=true&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl restart docker
</span></span></code></pre></div><h3 id=step-9-configuring-system-for-kubernetes-installation>Step 9: Configuring System for kubernetes installation</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>overlay
</span></span></span><span style=display:flex><span><span style=color:#e6db74>br_netfilter
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo modprobe overlay
</span></span><span style=display:flex><span>sudo modprobe br_netfilter
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt; EOF &gt; /etc/sysctl.d/k8s.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fs.file-max = 1500000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fs.nr_open = 1500000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.max_map_count = 262144
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.ip_local_reserved_ports = 30000-32767
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.ip_local_port_range = 1024 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.netfilter.nf_conntrack_max = 32768000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.swappiness = 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.ip_forward = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sysctl --system
</span></span></code></pre></div><p>Disable swap</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>swapoff -a
</span></span><span style=display:flex><span>sudo sed -i <span style=color:#e6db74>&#39;/ swap / s/^\(.*\)$/#\1/g&#39;</span> /etc/fstab
</span></span><span style=display:flex><span><span style=color:#75715e># remove swap from /etc/fstab</span>
</span></span><span style=display:flex><span><span style=color:#75715e># make sure swap in lvm mode removed from grub</span>
</span></span></code></pre></div><h3 id=step-10-install-kubernetes>Step 10: Install kubernetes</h3><p>Add kubernetes repository to system repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
</span></span><span style=display:flex><span>sudo apt-add-repository <span style=color:#e6db74>&#34;deb http://apt.kubernetes.io/ kubernetes-xenial main&#34;</span>
</span></span><span style=display:flex><span>sudo apt update
</span></span></code></pre></div><p>Install kubernetes packages:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y kubelet<span style=color:#f92672>=</span>1.23.15-00 kubeadm<span style=color:#f92672>=</span>1.23.15-00 kubectl<span style=color:#f92672>=</span>1.23.15-00
</span></span><span style=display:flex><span>sudo apt-mark hold kubelet kubeadm kubectl
</span></span></code></pre></div><p>Enable kubernetes service:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl enable kubelet
</span></span></code></pre></div><p>Pull kubernetes required container images:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm config --kubernetes-version 1.23.15 images pull
</span></span><span style=display:flex><span>docker pull docker.io/calico/kube-controllers:v3.24.5
</span></span><span style=display:flex><span>docker pull docker.io/calico/node:v3.24.5
</span></span><span style=display:flex><span>docker pull docker.io/calico/cni:v3.24.5
</span></span></code></pre></div><p>Download required manifest:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://raw.githubusercontent.com/projectcalico/calico/v3.24.5/manifests/calico.yaml -O
</span></span></code></pre></div><div class=edit-meta>Last updated on 11 Dec 2022<br>Published on 11 Dec 2022<br></div><nav class=pagination><a class="nav nav-prev" href=https://k8sops.ir/session1/scratch/ title="Create Lab from scratch on oracle linux"><i class="fas fa-arrow-left" aria-hidden=true></i> Prev - Create Lab from scratch on oracle linux</a>
<a class="nav nav-next" href=https://k8sops.ir/session1/ova/ title="Create Lab with OVA file">Next - Create Lab with OVA file <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://k8sops.ir/>Home</a></li><li class="parent has-sub-menu"><a href=https://k8sops.ir/session1/>Session 1<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://k8sops.ir/session1/scratch/>Create Lab from scratch on oracle linux</a></li><li class=active><a href=https://k8sops.ir/session1/scratch_ubuntu/>Create Lab from scratch on ubuntu 22.04</a></li><li><a href=https://k8sops.ir/session1/ova/>Create Lab with OVA file</a></li><li><a href=https://k8sops.ir/session1/vagrant/>Create Lab with Vagrant</a></li></ul></li><li class=has-sub-menu><a href=https://k8sops.ir/session6/>Session 6<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://k8sops.ir/session6/simple_pod/>Creating a simple Pod in Kubernetes</a></li><li><a href=https://k8sops.ir/session6/expose_port/>Exposing port from simple Pod in Kubernetes</a></li><li><a href=https://k8sops.ir/session6/expain_pod_manifest/>Explaining Pod manifest structure</a></li><li><a href=https://k8sops.ir/session6/liveness_probe/>Checking Pod with liveness probe in Kubernetes</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>